import arabic_reshaper
from bidi.algorithm import get_display
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Image
from reportlab.lib.styles import ParagraphStyle
from reportlab.lib.enums import TA_RIGHT
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
from reportlab.lib import colors
import qrcode

# Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„Ù PDF
doc = SimpleDocTemplate("cv_with_qr_email.pdf", rightMargin=30, leftMargin=30, topMargin=30, bottomMargin=60)

# ØªØ³Ø¬ÙŠÙ„ Ø®Ø· Ø¹Ø±Ø¨ÙŠ (Ù†Ø²Ù‘Ù„ Ø®Ø· Amiri Ø£Ùˆ Ø£ÙŠ Ø®Ø· Ø¹Ø±Ø¨ÙŠ ÙˆØ­Ø·Ù‡ Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯)
pdfmetrics.registerFont(TTFont("Amiri", "Amiri-Regular.ttf"))

# Ø¯Ø§Ù„Ø© ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
def ar_text(text):
    reshaped = arabic_reshaper.reshape(text)
    return get_display(reshaped)

# Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù†ØµÙˆØµ
style_title = ParagraphStyle(
    name="Title", fontName="Amiri", fontSize=18, alignment=TA_RIGHT,
    textColor=colors.HexColor("#0D47A1"), spaceAfter=14, leading=22
)
style_section = ParagraphStyle(
    name="Section", fontName="Amiri", fontSize=13, alignment=TA_RIGHT,
    textColor=colors.HexColor("#1565C0"), spaceAfter=8, leading=18
)
style_normal = ParagraphStyle(
    name="Normal", fontName="Amiri", fontSize=11, alignment=TA_RIGHT,
    textColor=colors.black, leading=16
)

# Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ø±ÙƒÙˆØ¯ QR Ù„Ù„Ø¥ÙŠÙ…ÙŠÙ„
qr_data = "mailto:Mohammed.a.hakami@gmail.com"
qr_img = qrcode.make(qr_data)
qr_path = "qr_email.png"
qr_img.save(qr_path)

# Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
content = []
content.append(Paragraph(ar_text("Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø­ÙƒÙ…ÙŠ"), style_title))
content.append(Paragraph(ar_text("Ø¥Ø¯Ø§Ø±ÙŠ ÙˆØªÙ†ÙÙŠØ°ÙŠ ÙŠØªÙ…ØªØ¹ Ø¨Ø®Ø¨Ø±Ø© ÙˆØ§Ø³Ø¹Ø© ÙˆÙ…ØªÙ†ÙˆØ¹Ø© ÙÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©ØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±ÙˆØ¹ ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ØŒ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±."), style_normal))
content.append(Spacer(1, 12))

content.append(Paragraph(ar_text("ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ù‡Ù†ÙŠ"), style_section))
content.append(Paragraph(ar_text("Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ù…Ø¤Ø³Ø³Ø§Øª Ø£Ùˆ Ø´Ø±ÙƒØ§Øª Ø±Ø§Ø¦Ø¯Ø© Ø£ÙØ³Ù‡Ù… ÙÙŠÙ‡Ø§ Ø¨Ø®Ø¨Ø±Ø§ØªÙŠ ÙÙŠ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©."), style_normal))
content.append(Spacer(1, 12))

# Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø©
qr_code_img = Image(qr_path, width=80, height=80)
content.append(Spacer(1, 100))
content.append(qr_code_img)

# Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ù„Ù
doc.build(content)