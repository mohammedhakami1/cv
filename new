import arabic_reshaper
from bidi.algorithm import get_display
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Image, Table, TableStyle
from reportlab.lib.styles import ParagraphStyle
from reportlab.lib.enums import TA_RIGHT
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
from reportlab.lib import colors
import qrcode

# تسجيل الخط العربي
pdfmetrics.registerFont(TTFont("Amiri", "Amiri-Regular.ttf"))

# دالة تجهيز النص العربي
def ar_text(text):
    reshaped = arabic_reshaper.reshape(text)
    return get_display(reshaped)

# أنماط النصوص
style_title = ParagraphStyle(name="Title", fontName="Amiri", fontSize=18,
                             alignment=TA_RIGHT, textColor=colors.HexColor("#0D47A1"),
                             spaceAfter=14, leading=22)
style_section = ParagraphStyle(name="Section", fontName="Amiri", fontSize=13,
                               alignment=TA_RIGHT, textColor=colors.HexColor("#1565C0"),
                               spaceAfter=6, leading=18)
style_normal = ParagraphStyle(name="Normal", fontName="Amiri", fontSize=11,
                              alignment=TA_RIGHT, textColor=colors.black, leading=16)

# إنشاء باركود QR للإيميل
qr_data = "mailto:Mohammed.a.hakami@gmail.com"
qr_img = qrcode.make(qr_data)
qr_path = "qr_email.png"
qr_img.save(qr_path)

# العمود الأيسر (معلومات شخصية + مهارات + باركود)
left_column = []
left_column.append(Paragraph(ar_text("📞 0599515695"), style_normal))
left_column.append(Paragraph(ar_text("✉ Mohammed.a.hakami@gmail.com"), style_normal))
left_column.append(Paragraph(ar_text("📍 السعودية"), style_normal))
left_column.append(Spacer(1, 12))

left_column.append(Paragraph(ar_text("🛠️ المهارات"), style_section))
skills = [
    "القيادة وإدارة الفرق",
    "الاستشارات الإدارية",
    "صياغة الاستراتيجيات",
    "التخطيط والتنظيم",
    "إدارة الجودة",
    "التواصل الفعال",
    "العمل تحت الضغط",
    "حل المشكلات",
    "الحاسب الآلي"
]
for skill in skills:
    left_column.append(Paragraph(ar_text("• " + skill), style_normal))
left_column.append(Spacer(1, 12))

left_column.append(Paragraph(ar_text("📚 الدورات"), style_section))
left_column.append(Paragraph(ar_text("الحاسب الآلي، القيادة، الإدارة العامة، إدارة المخاطر، الاقتصاد، التسويق، المبيعات، المشتريات، تطوير الذات، إدارة الوقت، إدارة المشاريع."), style_normal))
left_column.append(Spacer(1, 12))

left_column.append(Paragraph(ar_text("🌐 اللغات"), style_section))
left_column.append(Paragraph(ar_text("العربية: اللغة الأم"), style_normal))
left_column.append(Paragraph(ar_text("الإنجليزية: مستوى جيد"), style_normal))
left_column.append(Spacer(1, 30))

left_column.append(Image(qr_path, width=100, height=100))

# العمود الأيمن (المحتوى الأساسي)
right_column = []
right_column.append(Paragraph(ar_text("محمد عبدالرحمن حكمي"), style_title))
right_column.append(Paragraph(ar_text("إداري وتنفيذي يتمتع بخبرة واسعة ومتنوعة في الإدارة العامة، إدارة الفروع والمناطق، والتطوير."), style_normal))
right_column.append(Spacer(1, 12))

right_column.append(Paragraph(ar_text("🎯 الهدف المهني"), style_section))
right_column.append(Paragraph(ar_text("الانضمام إلى مؤسسات أو شركات رائدة أُسهم فيها بخبراتي في القيادة والإدارة لتطوير الأداء وتحقيق الأهداف الاستراتيجية، عبر تعزيز الكفاءة التشغيلية، ورفع مستويات الجودة والإنتاجية، وخلق قيمة مضافة مستدامة تدعم النجاح والتطور."), style_normal))
right_column.append(Spacer(1, 12))

right_column.append(Paragraph(ar_text("💼 الخبرات العملية"), style_section))
experiences = [