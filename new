import arabic_reshaper
from bidi.algorithm import get_display
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Image
from reportlab.lib.styles import ParagraphStyle
from reportlab.lib.enums import TA_RIGHT
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
from reportlab.lib import colors
import qrcode

# إعداد ملف PDF
doc = SimpleDocTemplate("cv_with_qr_email.pdf", rightMargin=30, leftMargin=30, topMargin=30, bottomMargin=60)

# تسجيل خط عربي (نزّل خط Amiri أو أي خط عربي وحطه بنفس المجلد)
pdfmetrics.registerFont(TTFont("Amiri", "Amiri-Regular.ttf"))

# دالة تجهيز النص العربي
def ar_text(text):
    reshaped = arabic_reshaper.reshape(text)
    return get_display(reshaped)

# أنماط النصوص
style_title = ParagraphStyle(
    name="Title", fontName="Amiri", fontSize=18, alignment=TA_RIGHT,
    textColor=colors.HexColor("#0D47A1"), spaceAfter=14, leading=22
)
style_section = ParagraphStyle(
    name="Section", fontName="Amiri", fontSize=13, alignment=TA_RIGHT,
    textColor=colors.HexColor("#1565C0"), spaceAfter=8, leading=18
)
style_normal = ParagraphStyle(
    name="Normal", fontName="Amiri", fontSize=11, alignment=TA_RIGHT,
    textColor=colors.black, leading=16
)

# إنشاء باركود QR للإيميل
qr_data = "mailto:Mohammed.a.hakami@gmail.com"
qr_img = qrcode.make(qr_data)
qr_path = "qr_email.png"
qr_img.save(qr_path)

# المحتوى الأساسي
content = []
content.append(Paragraph(ar_text("محمد عبدالرحمن حكمي"), style_title))
content.append(Paragraph(ar_text("إداري وتنفيذي يتمتع بخبرة واسعة ومتنوعة في الإدارة العامة، إدارة الفروع والمناطق، والتطوير."), style_normal))
content.append(Spacer(1, 12))

content.append(Paragraph(ar_text("🎯 الهدف المهني"), style_section))
content.append(Paragraph(ar_text("الانضمام إلى مؤسسات أو شركات رائدة أُسهم فيها بخبراتي في القيادة والإدارة لتطوير الأداء وتحقيق الأهداف الاستراتيجية."), style_normal))
content.append(Spacer(1, 12))

# إضافة باركود أسفل الصفحة
qr_code_img = Image(qr_path, width=80, height=80)
content.append(Spacer(1, 100))
content.append(qr_code_img)

# بناء الملف
doc.build(content)